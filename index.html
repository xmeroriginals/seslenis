<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="manifest" href="src/manifest.json" />
	<meta name="theme-color" content="#1e293b" />

    <meta
      name="description"
      content="Rastgele seçilen Kur'an sureleri ile yeniden bağlantı kurmanıza, düşünmenize ve huzur bulmanıza yardımcı olur."
    />
    <meta
      name="keywords"
      content="Kuran, Quran, Sesli Kuran, Ayet, Dinle, Turkish, Islam, İslam"
    />
    <meta name="author" content="Sesleniş" />
    <meta property="og:title" content="Sesleniş - Kuran Oynatıcı" />
    <meta
      property="og:description"
      content="Dinle, öğren, hisset. Ayetleri Arapça ve Türkçe olarak sıralı dinle."
    />
    <meta
      property="og:image"
      content="https://xmeroriginals.github.io/seslenis/assets/SeslenisSquareLogo.png"
    />
    <meta property="og:type" content="website" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Sesleniş - Kuran Oynatıcı" />
    <meta
      name="twitter:description"
      content="Rastgele seçilen Kur'an sureleri ile yeniden bağlantı kurmanıza, düşünmenize ve huzur bulmanıza yardımcı olur."
    />
    <meta
      name="twitter:image"
      content="https://xmeroriginals.github.io/seslenis/assets/SeslenisSquareLogo.png"
    />
    <link
      rel="icon"
      type="image/png"
      href="https://xmeroriginals.github.io/seslenis/assets/SeslenisLogo.png"
    />
    <link
      rel="apple-touch-icon"
      href="https://xmeroriginals.github.io/seslenis/assets/SeslenisSquareLogo.png"
    />
    <title>Sesleniş</title>
    <style>
      body {
        margin: 0;
        font-family: sans-serif;
        transition: background 0.3s, color 0.3s;
        background-size: cover;
        background-attachment: fixed;
      }
      body.light {
        background-image: url("https://xmeroriginals.github.io/seslenis/assets/LightBackground.png");
        color: #111827;
      }
      body.dark {
        background-image: url("https://xmeroriginals.github.io/seslenis/assets/DarkBackground.png");
        color: #f3f4f6;
      }
      nav {
        position: fixed;
        top: 0;
        width: 100%;
        backdrop-filter: blur(3px);
        background: rgb(250, 213, 140, 0.5);
        color: inherit;
        padding: 1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        z-index: 10;
        flex-wrap: wrap;
      }
      body.dark nav {
        background: rgba(31, 41, 55, 0.8);
      }
      .container {
        padding: 6rem 1rem 2rem;
        max-width: 700px;
        margin: 0 auto;
      }
      .card {
        padding: 2rem;
        border-radius: 1rem;
        background: rgba(255, 255, 255, 0.75);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      }
      body.dark .card {
        background: rgba(55, 65, 81, 0.93);
        color: #f9fafb;
      }
      .btn,
      .btngreen {
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        border: none;
        cursor: pointer;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        transition: 0.3s;
      }
      .btn {
        background: #e5e7eb;
      }
      .btn:hover {
        background: #d1d5db;
      }
      body.dark .btn {
        background: #4b5563;
        color: white;
      }
      body.dark .btn:hover {
        background: #6b7280;
      }
      .btngreen {
        background: #059669;
        color: white;
      }
      .btngreen:hover {
        background: #047857;
      }
      select {
        padding: 0.5rem;
        border-radius: 0.5rem;
        max-width: 200px;
        background: #f3f4f6;
        border: 1px solid #d1d5db;
        font-size: 0.9rem;
      }
      body.dark select {
        background: #4b5563;
        color: white;
        border-color: #6b7280;
      }
      .modal-wrapper {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(27, 27, 27, 0.5);
        justify-content: center;
        align-items: center;
        z-index: 20;
      }
      .modal-wrapper.active {
        display: flex !important;
        text-align: center;
        justify-content: center;
        align-items: center;
      }
      .modal-wrapper .box {
        background: white;
        padding: 2rem;
        border-radius: 1rem;
        max-width: 400px;
        width: 100%;
      }
      body.dark .modal-wrapper .box {
        background: #374151;
        color: white;
      }
      .dropdown {
        padding: 0.5rem;
        font-size: 1rem;
        width: 100%;
      }
      .flex {
        display: flex;
        gap: 0.75rem;
        flex-wrap: wrap;
        text-align: center;
        justify-content: center;
        align-items: center;
      }
      .text-right {
        text-align: right;
        font-size: 2rem;
        line-height: 2.5rem;
      }
      .icon {
        width: 20px;
        height: 20px;
      }
      .speakericon {
        margin-left: 25px;
        width: 20px;
        height: 20px;
        transition: filter 0.3s ease;
        filter: brightness(0);
        position: relative;
        right: -10px;
      }
      body.dark .speakericon {
        filter: invert(1);
      }
      .left-nav,
      .right-nav {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        flex-wrap: wrap;
      }

      #mobileMenu {
        position: fixed;
        top: 0;
        left: -100%;
        width: 70%;
        height: 100%;
        background: rgb(250, 213, 140, 0.5);
        backdrop-filter: blur(3px);
        color: inherit;
        padding: 1rem;
        z-index: 11;
        flex-direction: column;
        align-items: center;
        gap: 0.75rem;
        box-shadow: 2px 0 5px rgba(0, 0, 0, 0.2);
        transition: left 0.3s ease-in-out;
        overflow-y: auto;
      }

      body.dark #mobileMenu {
        background: rgba(31, 41, 55, 0.8);
      }

      #mobileMenu.active {
        left: 0;
      }

      #mobileMenu header {
        width: 100%;
        padding: 1rem 0;
        text-align: center;
        font-weight: bold;
        margin-bottom: 1rem;
      }

      #mobileMenu button,
      #mobileMenu select {
        width: 100%;
        padding: 0.75rem;
        border-radius: 0.5rem;
        border: none;
        cursor: pointer;
        font-weight: bold;
        text-align: center;
        transition: background 0.3s ease;
        margin-bottom: 10px;
      }

      #mobileMenu button {
        background: #e5e7eb;
        color: inherit;
      }

      #mobileMenu button:hover {
        background: #d1d5db;
      }

      body.dark #mobileMenu button {
        background: #4b5563;
        color: white;
      }

      body.dark #mobileMenu button:hover {
        background: #6b7280;
      }

      #mobileMenu #openSurahSelectModalBtnMobile,
      #mobileMenu #newSurahBtnMobile {
        background: #059669;
        color: white;
      }

      #mobileMenu #openSurahSelectModalBtnMobile:hover,
      #mobileMenu #newSurahBtnMobile:hover {
        background: #047857;
      }

      #menuToggle {
        display: none;
        background: none;
        border: none;
        cursor: pointer;
        padding: 0;
      }

      #menuToggle img {
        width: 30px;
        height: 30px;
        filter: invert(0);
        transition: filter 0.3s ease;
      }

      body.dark #menuToggle img {
        filter: invert(1);
      }

      #menuOverlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 10;
      }

      #menuOverlay.active {
        display: block;
      }

      @media (max-width: 768px) {
        .left-nav {
          display: none;
        }

        #menuToggle {
          display: block;
        }
      }

      .container {
        padding-top: calc(6rem + 56px);
      }

      #surahSelect {
        max-height: 200px;
        overflow-y: scroll;
        text-align: center;
        z-index: 21;
      }

      #mobileMenu header img {
        width: 30px;
        height: 30px;
        filter: invert(0);
        transition: filter 0.3s ease;
      }

      body.dark #mobileMenu header img {
        filter: invert(1);
      }

      #selectSurahBtn {
        display: block; /* Make it a block element */
        margin: 0 auto; /* Center horizontally */
        text-align: center; /* Center text inside the button */
      }
    </style>
  </head>
  <body>
    <nav>
      <div class="left-nav">
        <button class="btn" id="themeToggle">
          <img
            src="https://xmeroriginals.github.io/seslenis/assets/Dark.svg"
            id="themeIcon"
            class="icon"
            alt="Tema"
          />
        </button>
        <button class="btn" id="languageToggle" style="display:none">TR</button>
        <button class="btngreen" id="openSurahSelectModalBtn">Sûre Seç</button>
        <button class="btngreen" id="newSurahBtn">Rastgele Sûre</button>
        <button class="btn" id="startOverBtn">Baştan Başla</button>
      </div>

      <button class="btn" id="menuToggle">
        <img src="https://www.svgrepo.com/show/532195/menu.svg" alt="Menu" />
      </button>
    </nav>
    <div id="menuOverlay"></div>

    <div id="mobileMenu">
      <header>
        <img src="https://www.svgrepo.com/show/532195/menu.svg" alt="Menu" />
      </header>
      <button class="btn" id="themeToggleMobile">
        <img
          src="https://xmeroriginals.github.io/seslenis/assets/Dark.svg"
          id="themeIconMobile"
          class="icon"
          alt="Tema"
        />
      </button>
      <button class="btn" id="languageToggleMobile" style="display:none">TR</button>
      <button
        class="btngreen"
        id="openSurahSelectModalBtnMobile"
        onclick="showSelectSurahModal()"
      >
        Sûre Seç
      </button>
      <button
        class="btngreen"
        id="newSurahBtnMobile"
        onclick="startNewSurah()"
      >
        Rastgele Sûre
      </button>
      <button
        class="btn"
        id="startOverBtnMobile"
        onclick="startSurahOver()"
      >
        Baştan Başla
      </button>
    </div>

    <div class="container">
      <div class="card">
        <h1 id="ayahInfo">Sûre ? · ?  ✦  Ayet ?·?</h1>
        <p class="text-right" id="arabicText"></p>
        <p id="turkishText"></p>
      </div>
    </div>

    <div id="continueModal" class="modal-wrapper">
      <div class="box">
        <h2 id="continueModalTitle">
          Kaldığınız yerden devam etmek ister misiniz?
        </h2>
        <div class="flex" style="margin-top: 1rem">
          <button class="btngreen" id="continueBtn">Evet, Devam et</button>
          <button class="btn" id="startNewBtn">Rastgele Sûre</button>
        </div>
      </div>
    </div>

    <div id="surahCompletedModal" class="modal-wrapper">
      <div class="box">
        <h2 id="surahCompletedModalTitle">Sûre bitti, Ne yapmak istersiniz?</h2>
        <div class="flex" style="margin-top: 1rem">
          <button class="btngreen" id="newSurahModalBtn">Yeni Sûre</button>
          <button class="btn" id="restartSurahBtn">Baştan Başla</button>
        </div>
      </div>
    </div>

    <div id="selectSurahModal" class="modal-wrapper">
      <div class="box">
        <h2 id="selectSurahModalTitle">Sûre Seç</h2>
        <select id="surahSelect" class="dropdown">
          <option disabled selected id="selectSurahOption">Sûre Seçiniz</option>
        </select>
        <br /><br />
        <button id="selectSurahBtn" class="btngreen">Seç</button>
      </div>
    </div>

    <script>
      let ayahNames = [];
      let state = {
        language: "TR",
        ttsEnabled: false,
        voiceURI: "",
        surah: null,
        ayah: null,
      };

      const ayahInfo = document.getElementById("ayahInfo");
      const arabicText = document.getElementById("arabicText");
      const turkishText = document.getElementById("turkishText");
      const continueModal = document.getElementById("continueModal");
      const continueBtn = document.getElementById("continueBtn");
      const startNewBtn = document.getElementById("startNewBtn");
      const newSurahBtn = document.getElementById("newSurahBtn");
      const startOverBtn = document.getElementById("startOverBtn");
      const themeToggle = document.getElementById("themeToggle");
      const themeIcon = document.getElementById("themeIcon");
      const surahSelect = document.getElementById("surahSelect");
      const selectSurahBtn = document.getElementById("selectSurahBtn");
      const selectSurahModal = document.getElementById("selectSurahModal");
      const openSurahSelectModalBtn = document.getElementById(
        "openSurahSelectModalBtn"
      );
      const surahCompletedModal = document.getElementById(
        "surahCompletedModal"
      );

      const continueModalTitle = document.getElementById("continueModalTitle");
      const surahCompletedModalTitle = document.getElementById(
        "surahCompletedModalTitle"
      );
      const selectSurahModalTitle = document.getElementById(
        "selectSurahModalTitle"
      );
      const selectSurahOption = document.getElementById("selectSurahOption");

      const langMap = {
        TR: "tr.diyanet",
        EN: "tr.diyanet", //Fallback to turkish as english is removed
      };

      let currentAudio = null;

      const loadAyahNames = async () => {
        try {
          const res = await fetch(
            "https://xmeroriginals.github.io/seslenis/ayah-list/ayet.json"
          );
          if (!res.ok) throw new Error("Ayet listesi alınamadı");
          ayahNames = await res.json();

          ayahNames.forEach((name, index) => {
            const option = document.createElement("option");
            option.value = index + 1;
            option.textContent = `${index + 1}. ${name}`;
            surahSelect.appendChild(option);
          });
        } catch (err) {
          console.error("Ayet isimleri yüklenirken hata oluştu:", err);
        }
      };

      window.addEventListener("DOMContentLoaded", () => {
        loadAyahNames();
        applyLocalization();
      });

      const saveState = () => {
        localStorage.setItem("quranPlayerState", JSON.stringify(state));
        localStorage.setItem("ttsEnabled", JSON.stringify(state.ttsEnabled));
        localStorage.setItem("voiceURI", state.voiceURI);
      };

      function toggleLanguage() {
        state.language = "TR"; //Prevent from changing from TR
        saveLanguage(); // Save language immediately
        applyLocalization();
        playAyah();
      }

      function saveLanguage() {
        localStorage.setItem("language", state.language);
      }

      function loadLanguage() {
        state.language = "TR"; //Force default turkish
        localStorage.setItem("language", state.language);
      }

      const playAyah = async () => {
        try {
          if (!state.surah || !state.ayah) {
            startNew();
            return;
          }

          if (currentAudio) {
            currentAudio.pause();
            currentAudio.currentTime = 0;
          }

          const arabicRes = await fetch(
            `https://api.alquran.cloud/v1/ayah/${state.surah}:${state.ayah}/ar.alafasy`
          );
          if (!arabicRes.ok) {
            // If API returns error, fallback to 1:1
            state.surah = 1;
            state.ayah = 1;
            return playAyah(); // Recall playAyah to load 1:1
          }
          const arabic = await arabicRes.json();

          state.totalAyah = arabic.data.surah.numberOfAyahs || 0;
          arabicText.textContent = arabic.data.text;
          currentAudio = new Audio(arabic.data.audio);

          const translationLang = langMap[state.language];
          const turkishRes = await fetch(
            `https://api.alquran.cloud/v1/ayah/${state.surah}:${state.ayah}/${translationLang}`
          );
          if (!turkishRes.ok) {
            // If API returns error, fallback to 1:1
            state.surah = 1;
            state.ayah = 1;
            return playAyah(); // Recall playAyah to load 1:1
          }
          const turkish = await turkishRes.json();

          turkishText.textContent = turkish.data.text;
          const ayahName = ayahNames[state.surah - 1] || `Sûre ${state.surah}`;

          const ayahInfoText = `Sûre ${state.surah} · ${ayahName}  ✦  Ayet ${state.ayah}/${arabic.data.surah.numberOfAyahs}`;
          ayahInfo.innerHTML = ayahInfoText;

          saveState();

          currentAudio.onended = () => {
            if (state.ayah < state.totalAyah) {
              if (state.ttsEnabled) {
                const utterance = new SpeechSynthesisUtterance(
                  turkish.data.text
                );
                utterance.lang = "tr-TR";
                const selected = speechSynthesis
                  .getVoices()
                  .find((v) => v.voiceURI === state.voiceURI);
                if (selected) utterance.voice = selected;
                utterance.onend = () => {
                  state.ayah++;
                  playAyah();
                };
                speechSynthesis.speak(utterance);
              } else {
                state.ayah++;
                playAyah();
              }
            } else {
              showModal("surahCompletedModal");
            }
          };

          currentAudio.play();
        } catch (e) {
          console.error(e);
          // Removed alert; now it defaults to 1:1 silently.
          state.surah = 1;
          state.ayah = 1;
          playAyah(); // Recall playAyah to load 1:1
        }
      };

      const startNew = () => {
        if (currentAudio) {
          currentAudio.pause();
          currentAudio.currentTime = 0;
        }
        state.surah = Math.floor(Math.random() * 114) + 1;
        state.ayah = 1;
        playAyah();
      };

      const restartCurrentSurah = () => {
        if (currentAudio) {
          currentAudio.pause();
          currentAudio.currentTime = 0;
        }
        state.ayah = 1;
        playAyah();
      };

      const continueSaved = () => {
        const saved = localStorage.getItem("quranPlayerState");
        if (saved) {
          state = JSON.parse(saved);
          playAyah();
        }
      };

      const applyTheme = () => {
        const isDark = localStorage.getItem("darkMode") === "true";
        document.body.className = isDark ? "dark" : "light";
        themeIcon.src = isDark
          ? "https://xmeroriginals.github.io/seslenis/assets/Light.svg"
          : "https://xmeroriginals.github.io/seslenis/assets/Dark.svg";
      };

      themeToggle.onclick = () => {
        const current = document.body.className === "dark";
        localStorage.setItem("darkMode", !current);
        applyTheme();
      };

      newSurahBtn.onclick = startNew;
      startOverBtn.onclick = () => {
        state.ayah = 1;
        playAyah();
      };
      startNewBtn.onclick = () => {
        hideModal("continueModal");
        startNew();
      };
      continueBtn.onclick = () => {
        hideModal("continueModal");
        continueSaved();
      };

      openSurahSelectModalBtn.onclick = () => {
        showModal("selectSurahModal");
      };

      selectSurahBtn.onclick = () => {
        const selectedSurah = parseInt(surahSelect.value);
        if (!isNaN(selectedSurah)) {
          state.surah = selectedSurah;
          state.ayah = 1;
          hideModal("selectSurahModal");
          playAyah();
        } else {
          alert("Sûre seçiniz.");
        }
      };

      document.getElementById("newSurahModalBtn").onclick = () => {
        hideModal("surahCompletedModal");
        startNew();
      };
      document.getElementById("restartSurahBtn").onclick = () => {
        hideModal("surahCompletedModal");
        restartCurrentSurah();
      };

      let activeModal = null;

      const showModal = (modalId) => {
        if (activeModal) {
          hideModal(activeModal); // Hide previously active modal
        }
        document.getElementById(modalId).classList.add("active");
        activeModal = modalId;
      };

      const hideModal = (modalId) => {
        document.getElementById(modalId).classList.remove("active");
        if (activeModal === modalId) {
          activeModal = null;
        }
      };

      const applyLocalization = () => {
        document.getElementById("openSurahSelectModalBtn").textContent =
          "Sûre Seç";
        document.getElementById("newSurahBtn").textContent = "Rastgele Sûre";
        document.getElementById("startOverBtn").textContent = "Baştan Başla";

        continueModalTitle.textContent =
          "Kaldığınız yerden devam etmek ister misiniz?";
        continueBtn.textContent = "Evet, Devam et";
        startNewBtn.textContent = "Rastgele Sûre";

        surahCompletedModalTitle.textContent =
          "Sûre bitti, Ne yapmak istersiniz?";
        document.getElementById("newSurahModalBtn").textContent = "Yeni Sûre";
        document.getElementById("restartSurahBtn").textContent =
          "Baştan Başla";

        selectSurahModalTitle.textContent = "Sûre Seç";
        selectSurahOption.textContent = "Sûre Seçiniz";
        selectSurahBtn.textContent = "Seç";

        document.getElementById("languageToggle").style.display = "none";

        document.getElementById("languageToggleMobile").style.display = "none";
        document.getElementById("openSurahSelectModalBtnMobile").textContent =
          "Sûre Seç";
        document.getElementById("newSurahBtnMobile").textContent =
          "Rastgele Sûre";
        document.getElementById("startOverBtnMobile").textContent =
          "Baştan Başla";
      };

      window.onload = () => {
        applyTheme();
        state.ttsEnabled = localStorage.getItem("ttsEnabled") === "true";
        state.voiceURI = localStorage.getItem("voiceURI") || "";
        const savedState = localStorage.getItem("quranPlayerState");

        loadLanguage(); // Load the language setting

        if (savedState) {
          state = JSON.parse(savedState);
          showModal("continueModal");
        } else {
          startNew();
        }
        applyLocalization();
      };

      const languageToggle = document.getElementById("languageToggle");
      languageToggle.addEventListener("click", toggleLanguage);

      const menuToggle = document.getElementById("menuToggle");
      const mobileMenu = document.getElementById("mobileMenu");
      const menuOverlay = document.getElementById("menuOverlay");

      function openMobileMenu() {
        mobileMenu.classList.add("active");
        menuOverlay.classList.add("active");
      }

      function closeMobileMenu() {
        mobileMenu.classList.remove("active");
        menuOverlay.classList.remove("active");
      }

      menuToggle.addEventListener("click", () => {
        openMobileMenu();
      });

      menuOverlay.addEventListener("click", () => {
        closeMobileMenu();
      });

      // Mobile Menu Functions
      function showSelectSurahModal() {
        showModal("selectSurahModal");
        closeMobileMenu();
      }

      function startNewSurah() {
        startNew();
        closeMobileMenu();
      }

      function startSurahOver() {
        state.ayah = 1;
        playAyah();
        closeMobileMenu();
      }

      const languageToggleMobile = document.getElementById(
        "languageToggleMobile"
      );
      const themeToggleMobile = document.getElementById("themeToggleMobile");

      languageToggleMobile.addEventListener("click", () => {
        toggleLanguage();
        closeMobileMenu();
      });

      themeToggleMobile.addEventListener("click", () => {
        const current = document.body.className === "dark";
        localStorage.setItem("darkMode", !current);
        applyTheme();
        closeMobileMenu();
      });
    </script>
  </body>
</html>
