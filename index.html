<!DOCTYPE html>
<html lang="en" class="">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Yeniden bağlanmanıza, düşünmenize ve huzur bulmanıza yardımcı olmak için rastgele seçilmiş Kur'an surelerini çevirileriyle birlikte sunar."
    />
    <meta
      name="keywords"
      content="Kuran, Quran, Sesli Kuran, Ayet, Dinle, Turkish, English, Islam, İslam"
    />
    <meta name="author" content="Sesleniş" />
    <meta property="og:title" content="Sesleniş - Quran Player" />
    <meta
      property="og:description"
      content="Dinle, öğren, hisset. Ayetleri Arapça ve Türkçe olarak sırayla dinleyin."
    />
    <meta
      property="og:image"
      content="https://xmeroriginals.github.io/seslenis/assets/SeslenisLogo.png"
    />
    <meta property="og:type" content="website" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Sesleniş - Quran Player" />
    <meta
      name="twitter:description"
      content="Yeniden bağlanmanıza, düşünmenize ve huzur bulmanıza yardımcı olmak için rastgele seçilmiş Kur'an surelerini çevirileriyle birlikte sunar."
    />
    <meta
      name="twitter:image"
      content="https://xmeroriginals.github.io/seslenis/assets/SeslenisLogo.png"
    />
    <link
      rel="icon"
      type="image/png"
      href="https://xmeroriginals.github.io/seslenis/assets/SeslenisLogo.png"
    />
    <link
      rel="apple-touch-icon"
      href="https://xmeroriginals.github.io/seslenis/assets/SeslenisLogo.png"
    />
    <title>Sesleniş</title>
    <style>
      body {
        margin: 0;
        font-family: sans-serif;
        transition: background 0.3s, color 0.3s;
        background-size: cover;
        background-attachment: fixed;
      }
      body.light {
        background-image: url("https://xmeroriginals.github.io/seslenis/assets/LightBackground.png");
        color: #111827;
      }
      body.dark {
        background-image: url("https://xmeroriginals.github.io/seslenis/assets/DarkBackground.png");
        color: #f3f4f6;
      }
      nav {
        position: fixed;
        top: 0;
        width: 100%;
        backdrop-filter: blur(3px);
        background: rgb(250, 213, 140, 0.5);
        color: inherit;
        padding: 1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        z-index: 10;
        flex-wrap: wrap;
      }
      body.dark nav {
        background: rgba(31, 41, 55, 0.8);
      }
      .container {
        padding: 6rem 1rem 2rem;
        max-width: 700px;
        margin: 0 auto;
      }
      .card {
        padding: 2rem;
        border-radius: 1rem;
        background: rgba(255, 255, 255, 0.75);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      }
      body.dark .card {
        background: rgba(55, 65, 81, 0.93);
        color: #f9fafb;
      }
      .btn,
      .btngreen {
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        border: none;
        cursor: pointer;
        font-weight: bold;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        transition: 0.3s;
      }
      .btn {
        background: #e5e7eb;
      }
      .btn:hover {
        background: #d1d5db;
      }
      body.dark .btn {
        background: #4b5563;
        color: white;
      }
      body.dark .btn:hover {
        background: #6b7280;
      }
      .btngreen {
        background: #059669;
        color: white;
      }
      .btngreen:hover {
        background: #047857;
      }
      select {
        padding: 0.5rem;
        border-radius: 0.5rem;
        max-width: 200px;
        background: #f3f4f6;
        border: 1px solid #d1d5db;
        font-size: 0.9rem;
      }
      body.dark select {
        background: #4b5563;
        color: white;
        border-color: #6b7280;
      }
      #modal {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(27, 27, 27, 0.5);
        justify-content: center;
        align-items: center;
      }
      #modal .box {
        background: white;
        padding: 2rem;
        border-radius: 1rem;
        max-width: 400px;
        width: 100%;
      }
      body.dark #modal .box {
        background: #374151;
        color: white;
      }
      #surahCompletedModal {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(27, 27, 27, 0.5);
        justify-content: center;
        align-items: center;
      }
      #surahCompletedModal .box {
        background: white;
        padding: 2rem;
        border-radius: 1rem;
        max-width: 400px;
        width: 100%;
      }
      body.dark #surahCompletedModal .box {
        background: #374151;
        color: white;
      }
      .flex {
        display: flex;
        gap: 0.75rem;
        flex-wrap: wrap;
        text-align: center;
        justify-content: center;
        align-items: center;
      }
      .text-right {
        text-align: right;
        font-size: 2rem;
        line-height: 2.5rem;
      }
      .icon {
        width: 20px;
        height: 20px;
      }
      .speakericon {
        margin-left: 25px;
        width: 20px;
        height: 20px;
        transition: filter 0.3s ease;
        filter: brightness(0);
        position: relative;
        right: -10px;
      }
      body.dark .speakericon {
        filter: invert(1);
      }
      .left-nav,
      .right-nav {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        flex-wrap: wrap;
      }
    </style>
  </head>
  <body>
    <nav>
      <div class="left-nav">
        <button class="btn" id="themeToggle">
          <img
            src="https://xmeroriginals.github.io/seslenis/assets/Dark.svg"
            id="themeIcon"
            class="icon"
            alt="Theme"
          />
        </button>
        <button class="btngreen" id="newSurahBtn">Yeni Sûre</button>
        <button class="btn" id="startOverBtn">Baştan Başla</button>
        <img
          src="https://xmeroriginals.github.io/seslenis/assets/Speaker.svg"
          class="speakericon"
          alt="TTS"
        />
        <label><input type="checkbox" id="ttsToggle" /></label>
        <select id="voiceSelect"></select>
      </div>
    </nav>

    <div class="container">
      <div class="card">
        <h1 id="ayahInfo">Sûre ? · ?&nbsp;&nbsp;✦&nbsp;&nbsp;Ayet ?·?</h1>
        <p class="text-right" id="arabicText"></p>
        <p id="turkishText"></p>
      </div>
    </div>

    <div id="modal" class="flex">
      <div class="box">
        <h2>Kaldığınız yerden devam etmek ister misiniz?</h2>
        <div class="flex" style="margin-top: 1rem">
          <button class="btngreen" id="continueBtn">Evet, Devam et</button>
          <button class="btn" id="startNewBtn">Baştan Başla</button>
        </div>
      </div>
    </div>

    <div id="surahCompletedModal" class="flex">
      <div class="box">
        <h2>Sûre bitti, Ne yapmak istersiniz?</h2>
        <div class="flex" style="margin-top: 1rem">
          <button class="btngreen" id="newSurahModalBtn">Yeni Sûre</button>
          <button class="btn" id="restartSurahBtn">Baştan Başla</button>
        </div>
      </div>
    </div>

    <script>
      let ayahNames = [];
      const ayahInfo = document.getElementById("ayahInfo");
      const arabicText = document.getElementById("arabicText");
      const turkishText = document.getElementById("turkishText");
      const modal = document.getElementById("modal");
      const continueBtn = document.getElementById("continueBtn");
      const startNewBtn = document.getElementById("startNewBtn");
      const newSurahBtn = document.getElementById("newSurahBtn");
      const startOverBtn = document.getElementById("startOverBtn");
      const ttsToggle = document.getElementById("ttsToggle");
      const themeToggle = document.getElementById("themeToggle");
      const themeIcon = document.getElementById("themeIcon");
      const voiceSelect = document.getElementById("voiceSelect");
      let currentAudio = null;

      const loadAyahNames = async () => {
        try {
          const res = await fetch(
            "https://xmeroriginals.github.io/seslenis/ayah-list/ayet.json"
          );
          if (!res.ok) throw new Error("Ayet listesi alınamadı");
          ayahNames = await res.json();
        } catch (err) {
          console.error("Ayet isimleri yüklenirken hata oluştu:", err);
        }
      };

      window.addEventListener("DOMContentLoaded", () => {
        loadAyahNames();
      });

      let state = {
        surah: 1,
        ayah: 1,
        totalAyah: 1,
        ttsEnabled: false,
        voiceURI: "",
      };

      const saveState = () => {
        localStorage.setItem("quranPlayerState", JSON.stringify(state));
        localStorage.setItem("ttsEnabled", JSON.stringify(state.ttsEnabled));
        localStorage.setItem("voiceURI", state.voiceURI);
      };

      const populateVoices = () => {
        const voices = speechSynthesis.getVoices();
        voiceSelect.innerHTML = "";
        voices.forEach((voice) => {
          const option = document.createElement("option");
          option.value = voice.voiceURI;
          option.text = `${voice.name} (${voice.lang})`;
          if (voice.voiceURI === state.voiceURI) {
            option.selected = true;
          }
          voiceSelect.appendChild(option);
        });
      };

      const playAyah = async () => {
        try {
          if (currentAudio) {
            currentAudio.pause();
            currentAudio.currentTime = 0;
          }

          const arabicRes = await fetch(
            `https://api.alquran.cloud/v1/ayah/${state.surah}:${state.ayah}/ar.alafasy`
          );
          const arabic = await arabicRes.json();

          state.totalAyah = arabic.data.surah.numberOfAyahs || 0;
          arabicText.textContent = arabic.data.text;
          currentAudio = new Audio(arabic.data.audio);

          const turkishRes = await fetch(
            `https://api.alquran.cloud/v1/ayah/${state.surah}:${state.ayah}/tr.diyanet`
          );
          const turkish = await turkishRes.json();

          turkishText.textContent = turkish.data.text;
          const ayahName = ayahNames[state.surah - 1] || `Surah ${state.surah}`;
          ayahInfo.innerHTML = `Sûre ${state.surah} · ${ayahName}&nbsp;&nbsp;✦&nbsp;&nbsp;Ayet ${state.ayah}·${arabic.data.surah.numberOfAyahs}`;

          saveState();

          currentAudio.onended = () => {
            if (state.ayah < state.totalAyah) {
              if (state.ttsEnabled) {
                const utterance = new SpeechSynthesisUtterance(
                  turkish.data.text
                );
                utterance.lang = "tr-TR";
                const selected = speechSynthesis
                  .getVoices()
                  .find((v) => v.voiceURI === state.voiceURI);
                if (selected) utterance.voice = selected;
                utterance.onend = () => {
                  state.ayah++;
                  playAyah();
                };
                speechSynthesis.speak(utterance);
              } else {
                state.ayah++;
                playAyah();
              }
            } else {
              document.getElementById("surahCompletedModal").style.display =
                "flex";
            }
          };

          currentAudio.play();
        } catch (e) {
          alert("Error occurred. Please try again.");
        }
      };

      const startNew = () => {
        if (currentAudio) {
          currentAudio.pause();
          currentAudio.currentTime = 0;
        }
        state.surah = Math.floor(Math.random() * 114) + 1;
        state.ayah = 1;
        playAyah();
      };

      const restartCurrentSurah = () => {
        if (currentAudio) {
          currentAudio.pause();
          currentAudio.currentTime = 0;
        }
        state.ayah = 1;
        playAyah();
      };

      const continueSaved = () => {
        const saved = localStorage.getItem("quranPlayerState");
        if (saved) {
          state = JSON.parse(saved);
          playAyah();
        }
      };

      const applyTheme = () => {
        const isDark = localStorage.getItem("darkMode") === "true";
        document.body.className = isDark ? "dark" : "light";
        themeIcon.src = isDark
          ? "https://xmeroriginals.github.io/seslenis/assets/Light.svg"
          : "https://xmeroriginals.github.io/seslenis/assets/Dark.svg";
      };

      themeToggle.onclick = () => {
        const current = document.body.className === "dark";
        localStorage.setItem("darkMode", !current);
        applyTheme();
      };

      newSurahBtn.onclick = startNew;
      startOverBtn.onclick = () => {
        state.ayah = 1;
        playAyah();
      };
      startNewBtn.onclick = () => {
        modal.style.display = "none";
        startNew();
      };
      continueBtn.onclick = () => {
        modal.style.display = "none";
        continueSaved();
      };
      voiceSelect.onchange = (e) => {
        state.voiceURI = e.target.value;
        saveState();
      };

      document.getElementById("newSurahModalBtn").onclick = () => {
        document.getElementById("surahCompletedModal").style.display = "none";
        startNew();
      };
      document.getElementById("restartSurahBtn").onclick = () => {
        document.getElementById("surahCompletedModal").style.display = "none";
        restartCurrentSurah();
      };
      startNewBtn.onclick = () => {
        modal.style.display = "none";
        restartCurrentSurah();
      };

      window.onload = () => {
        applyTheme();
        state.ttsEnabled = localStorage.getItem("ttsEnabled") === "true";
        state.voiceURI = localStorage.getItem("voiceURI") || "";
        ttsToggle.checked = state.ttsEnabled;
        ttsToggle.onchange = (e) => {
          state.ttsEnabled = e.target.checked;
          saveState();
        };
        populateVoices();
        if (localStorage.getItem("quranPlayerState")) {
          modal.style.display = "flex";
        } else {
          startNew();
        }
      };

      speechSynthesis.onvoiceschanged = populateVoices;
    </script>
  </body>
</html>
